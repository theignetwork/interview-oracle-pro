<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interview Oracle PRO - AI-Powered Interview Preparation Suite</title>
  <meta name="description" content="PRO version with intelligent tailored answers, context-appropriate methodologies, session saving, and unlimited usage. Premium interview preparation tool by The Interview Guys.">

  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z6WS2VE8K9"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-Z6WS2VE8K9');
  </script>

  <link rel="stylesheet" href="style.css">

  <!-- Jose Library for JWT (Smart Context) -->
  <script type="module">
    import * as jose from 'https://cdn.jsdelivr.net/npm/jose@5.2.0/+esm';
    window.jwtVerify = jose.jwtVerify;
  </script>

  <!-- Supabase Client for Interview Coach Integration -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Initialize Supabase client
    window.supabaseClient = null;

    try {
      const SUPABASE_URL = 'https://snhezroznzsjcqqxpjpp.supabase.co';
      const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNuaGV6cm96bnpzamNxcXhwanBwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU2OTM0NDcsImV4cCI6MjA2MTI2OTQ0N30.KyySx7uxtC_GRB_NF9DYCA9N350ajZ1uQ6hvYDkHiLY';

      window.supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
      console.log('‚úÖ Supabase client initialized');
    } catch (error) {
      console.warn('‚ö†Ô∏è Supabase client failed to initialize:', error);
      // App continues to work without Supabase
    }
  </script>
</head>
<body>
  <div class="app-container">
    <!-- Header Section -->
    <header class="app-header">
      <div class="header-content">
        <div class="brand">
          <h1 class="app-title">INTERVIEW <span class="highlight">ORACLE</span> <span class="pro-badge">PRO</span></h1>
          <p class="app-subtitle">Advanced Interview Preparation Suite</p>
        </div>
        <div class="member-info">
          <span class="welcome-text">Welcome, <span id="memberName">PRO Member</span>!</span>
          <div class="usage-status">
            <span class="usage-text">Unlimited Usage</span>
            <div class="pro-indicator"></div>
          </div>
        </div>
      </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="tab-navigation">
      <button class="tab-button active" data-tab="generate">
        <span class="tab-icon">‚ö°</span>
        <span class="tab-label">Generate</span>
      </button>
      <button class="tab-button" data-tab="answers">
        <span class="tab-icon">üí°</span>
        <span class="tab-label">Answers</span>
      </button>
      <button class="tab-button" data-tab="saved">
        <span class="tab-icon">üíæ</span>
        <span class="tab-label">Saved</span>
      </button>
      <button class="tab-button" data-tab="stats">
        <span class="tab-icon">üìä</span>
        <span class="tab-label">Stats</span>
      </button>
    </nav>

    <!-- Global Error Message -->
    <div class="error-message hidden" id="globalError"></div>

    <!-- Global Loading State -->
    <div class="loading-overlay hidden" id="globalLoading">
      <div class="loading-spinner"></div>
      <p class="loading-text" id="loadingText">Processing...</p>
    </div>

    <!-- Main Content Area -->
    <main class="main-content">

      <!-- Generate Questions Tab -->
      <section class="tab-content active" id="generate-tab">
        <div class="content-header">
          <h2 class="section-title">Generate Interview Questions</h2>
          <p class="section-description">Create personalized questions based on your job description</p>
        </div>

        <!-- Smart Context Success Banner -->
        <div id="smartContextBanner" class="smart-context-banner hidden">
          <div class="banner-content">
            <div class="banner-icon">‚ú®</div>
            <div class="banner-text">
              <div class="banner-title">Job Details Auto-Loaded!</div>
              <div class="banner-description">
                Context from <strong id="contextCompany">Career Hub</strong> - <span id="contextPosition">Position</span> has been automatically filled.
              </div>
            </div>
            <button class="banner-close" id="closeBanner" aria-label="Close">√ó</button>
          </div>
        </div>

        <form class="question-form" id="questionForm">
          <div class="form-group">
            <label for="jobDescription" class="form-label">
              Job Description
              <span class="tip-icon" title="">
                ‚ÑπÔ∏è
                <div class="tip-tooltip">
                  <div class="tip-header">Jeff & Mike's Tip:</div>
                  Include specific requirements and company values for more targeted question generation
                </div>
              </span>
            </label>
            <textarea
              id="jobDescription"
              class="form-textarea"
              placeholder="Paste the complete job description here..."
              rows="6"
              maxlength="3000"
              required
            ></textarea>
            <div class="char-counter">
              <span id="charCount">0</span> / 3000 characters
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="roleSelector" class="form-label">Role Category</label>
              <select id="roleSelector" class="form-select" required>
                <option value="">Select a role...</option>
                <option value="General">General</option>
                <option value="Software Engineering">Software Engineering</option>
                <option value="Data Analytics">Data & Analytics</option>
                <option value="Marketing">Marketing</option>
                <option value="Sales">Sales</option>
                <option value="Finance">Finance & Accounting</option>
                <option value="Operations">Operations</option>
                <option value="Product Management">Product Management</option>
                <option value="Customer Support">Customer Support</option>
                <option value="Healthcare">Healthcare</option>
                <option value="Education">Education</option>
                <option value="Human Resources">Human Resources</option>
                <option value="Retail Hospitality">Retail & Hospitality</option>
                <option value="Manufacturing">Manufacturing & Supply Chain</option>
                <option value="Construction">Construction & Trades</option>
                <option value="Government">Government & Non-Profit</option>
                <option value="Legal">Legal</option>
                <option value="Creative Design">Creative & Design</option>
                <option value="Real Estate">Real Estate</option>
                <option value="Transportation">Transportation & Logistics</option>
              </select>
            </div>

            <div class="form-group">
              <label for="experienceLevel" class="form-label">Experience Level</label>
              <select id="experienceLevel" class="form-select" required>
                <option value="">Select experience...</option>
                <option value="Entry Level">Entry Level (0-2 years)</option>
                <option value="Mid Level">Mid Level (2-5 years)</option>
                <option value="Senior Level">Senior Level (5-8 years)</option>
                <option value="Lead/Manager">Lead/Manager (8+ years)</option>
                <option value="Executive">Executive/Director</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="companyName" class="form-label">Company Name (Optional)</label>
            <input
              type="text"
              id="companyName"
              class="form-input"
              placeholder="e.g., Google, Microsoft, etc."
              maxlength="100"
            >
          </div>

          <button type="submit" class="primary-button" id="generateBtn">
            <span class="button-icon">‚ö°</span>
            Generate Interview Questions
          </button>
        </form>

        <!-- Questions Results -->
        <div class="questions-results hidden" id="questionsResults">
          <div class="results-header">
            <h3 class="results-title">Your Personalized Interview Questions</h3>
            <div class="results-actions">
              <button class="action-button" id="selectAllQuestions">Select All</button>
              <button class="action-button primary" id="generateAnswersBtn">Generate Answers</button>
              <button class="action-button" id="saveSessionBtn">Save Session</button>
            </div>
          </div>

          <div class="question-categories" id="questionCategories">
            <!-- Question categories will be populated by JavaScript -->
          </div>
        </div>
      </section>

      <!-- SOAR Answers Tab -->
      <section class="tab-content" id="answers-tab">
        <div class="content-header">
          <h2 class="section-title">Professional Answers
            <span class="tip-icon" title="">
              ‚ÑπÔ∏è
              <div class="tip-tooltip">
                <div class="tip-header">Jeff & Mike's Tip:</div>
                Each answer uses proven methodologies - SOAR for behavioral, research-based for company fit, structured for technical
              </div>
            </span>
          </h2>
          <p class="section-description">Generate professional answers using appropriate interview methodologies for each question type</p>
        </div>

        <div class="answers-setup" id="answersSetup">
          <div class="selected-questions-preview" id="selectedQuestionsPreview">
            <p class="no-selection">Select questions from the Generate tab to create tailored answers.</p>
          </div>

        </div>

        <div class="answers-container" id="answersContainer">
          <!-- Generated answers will be populated here -->
        </div>
      </section>


      <!-- Saved Sessions Tab -->
      <section class="tab-content" id="saved-tab">
        <div class="content-header">
          <h2 class="section-title">Saved Sessions
            <span class="tip-icon" title="">
              ‚ÑπÔ∏è
              <div class="tip-tooltip">
                <div class="tip-header">Jeff & Mike's Tip:</div>
                Review saved sessions before interviews to refresh your prepared answers and practice delivery
              </div>
            </span>
          </h2>
          <p class="section-description">Access your saved interview question sets and tailored answers</p>
        </div>

        <div class="saved-sessions" id="savedSessions">
          <!-- Saved sessions will be populated by JavaScript -->
        </div>

        <div class="empty-state hidden" id="emptySavedSessions">
          <div class="empty-icon">üíæ</div>
          <h3 class="empty-title">No Saved Sessions</h3>
          <p class="empty-description">Generate questions and save your sessions to access them here.</p>
        </div>
      </section>

      <!-- Analytics Dashboard Tab -->
      <section class="tab-content" id="stats-tab">
        <div class="content-header">
          <h2 class="section-title">Usage Analytics</h2>
          <p class="section-description">Track your interview preparation progress</p>
        </div>

        <div class="stats-grid" id="statsGrid">
          <!-- Stats cards will be populated by JavaScript -->
        </div>

        <div class="activity-timeline" id="activityTimeline">
          <h3 class="timeline-title">Recent Activity</h3>
          <div class="timeline-content" id="timelineContent">
            <!-- Activity items will be populated by JavaScript -->
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- Smart Context Auto-Population Script -->
  <script>
    // Smart Context Detection and Auto-Fill
    (async function() {
      try {
        // Check for context parameter in URL
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('context');

        if (!token) {
          console.log('[Oracle Smart Context] No context parameter found');
          return;
        }

        console.log('[Oracle Smart Context] Context token detected, attempting to decode...');

        // Wait for jose library to load
        let attempts = 0;
        while (!window.jwtVerify && attempts < 20) {
          console.log('[Oracle Smart Context] Waiting for jose library...');
          await new Promise(resolve => setTimeout(resolve, 100));
          attempts++;
        }

        if (!window.jwtVerify) {
          console.error('[Oracle Smart Context] Jose library failed to load');
          return;
        }

        // Decode JWT token
        const secret = new TextEncoder().encode('41d7608f24c106eeab002add62ea7b614173a6a6e9a95eaee7505936d8c51edc');
        const { payload } = await window.jwtVerify(token, secret);

        console.log('[Oracle Smart Context] Successfully decoded:', payload);

        // Build job description from context
        let jobDesc = '';

        if (payload.companyName || payload.positionTitle) {
          jobDesc += `Company: ${payload.companyName || 'Not specified'}\n`;
          jobDesc += `Position: ${payload.positionTitle || 'Not specified'}\n\n`;
        }

        if (payload.location) jobDesc += `Location: ${payload.location}\n`;
        if (payload.remoteType) jobDesc += `Work Type: ${payload.remoteType}\n`;
        if (payload.salaryRange) jobDesc += `Salary: ${payload.salaryRange}\n`;
        if (payload.location || payload.remoteType || payload.salaryRange) jobDesc += '\n';

        if (payload.jobDescription) {
          jobDesc += `Job Description:\n${payload.jobDescription}`;
        }

        // Wait for DOM to be ready
        if (document.readyState === 'loading') {
          await new Promise(resolve => document.addEventListener('DOMContentLoaded', resolve));
        }

        // Auto-fill the job description textarea
        const textarea = document.getElementById('jobDescription');
        if (textarea) {
          textarea.value = jobDesc;

          // Trigger char counter update if it exists
          const charCount = document.getElementById('charCount');
          if (charCount) {
            charCount.textContent = jobDesc.length;
          }

          console.log('[Oracle Smart Context] Job description auto-filled successfully');
        }

        // Show success banner
        const banner = document.getElementById('smartContextBanner');
        const companyEl = document.getElementById('contextCompany');
        const positionEl = document.getElementById('contextPosition');

        if (banner) {
          if (companyEl) companyEl.textContent = payload.companyName || 'Career Hub';
          if (positionEl) positionEl.textContent = payload.positionTitle || 'Position';
          banner.classList.remove('hidden');

          // Add close button functionality
          const closeBtn = document.getElementById('closeBanner');
          if (closeBtn) {
            closeBtn.addEventListener('click', () => {
              banner.classList.add('hidden');
            });
          }
        }

        // Clean URL
        window.history.replaceState({}, '', window.location.pathname);

        console.log('[Oracle Smart Context] ‚úÖ Smart Context loaded successfully!');

      } catch (error) {
        console.error('[Oracle Smart Context] Failed to load context:', error);
        // Fail silently - don't disrupt normal usage
      }
    })();
  </script>

  <script src="app.js"></script>
</body>
</html>